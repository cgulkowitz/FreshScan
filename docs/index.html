<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.6">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Receipt → Storage &amp; Expiration Chart</title>
<style>
<span class="Apple-converted-space">  </span>:root{
<span class="Apple-converted-space">    </span>--bg:#0f0f12; --card:#17181c; --muted:#9aa0a6; --txt:#e8eaed; --accent:#8ab4f8;
<span class="Apple-converted-space">    </span>--red:#ff6b6b; --yellow:#ffd166; --green:#06d6a0; --blue:#48cae4;
<span class="Apple-converted-space">    </span>--border:#2a2e35;
<span class="Apple-converted-space">  </span>}
<span class="Apple-converted-space">  </span>*{box-sizing:border-box}
<span class="Apple-converted-space">  </span>body{margin:0; font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif; color:var(--txt); background:linear-gradient(180deg,#0b0c10,#101114 40%, #0f1116)}
<span class="Apple-converted-space">  </span>header{padding:28px 20px 8px; text-align:center}
<span class="Apple-converted-space">  </span>header h1{margin:0 0 6px; font-size:clamp(22px,4vw,32px); letter-spacing:.2px}
<span class="Apple-converted-space">  </span>header p{margin:0; color:var(--muted)}
<span class="Apple-converted-space">  </span>main{max-width:1100px; margin:18px auto 56px; padding:0 16px}
<span class="Apple-converted-space">  </span>.controls, .output, .about{background:var(--card); border:1px solid var(--border); border-radius:14px; padding:16px; margin:14px 0}
<span class="Apple-converted-space">  </span>.row{display:flex; flex-wrap:wrap; gap:12px; align-items:center}
<span class="Apple-converted-space">  </span>.row > *{flex:1 1 220px}
<span class="Apple-converted-space">  </span>label{display:block; font-size:13px; color:var(--muted); margin-bottom:6px}
<span class="Apple-converted-space">  </span>input[type="file"]{padding:10px; border:1px dashed var(--border); border-radius:10px; background:#101217}
<span class="Apple-converted-space">  </span>input[type="date"], input[type="text"], select{width:100%; padding:10px 12px; border:1px solid var(--border); border-radius:10px; background:#101217; color:var(--txt)}
<span class="Apple-converted-space">  </span>.btn{display:inline-flex; gap:8px; align-items:center; padding:10px 14px; border:1px solid var(--border); border-radius:10px; background:#14161b; color:var(--txt); cursor:pointer; text-decoration:none; user-select:none}
<span class="Apple-converted-space">  </span>.btn:hover{border-color:#38414a}
<span class="Apple-converted-space">  </span>.btn.primary{background:linear-gradient(180deg,#1f2431,#19202b); border-color:#2a3645; color:#e6f0ff}
<span class="Apple-converted-space">  </span>.btn.success{background:#113630; border-color:#1b5046}
<span class="Apple-converted-space">  </span>.btn.warn{background:#3a2f12; border-color:#5f4a1a}
<span class="Apple-converted-space">  </span>.btn.ghost{background:transparent}
<span class="Apple-converted-space">  </span>.progress{height:10px; background:#0d1116; border:1px solid var(--border); border-radius:999px; overflow:hidden; margin-top:10px}
<span class="Apple-converted-space">  </span>.progress span{display:block; height:100%; width:0%; background:linear-gradient(90deg,#6ea8fe,#65d6ff)}
<span class="Apple-converted-space">  </span>table{width:100%; border-collapse:collapse; margin-top:8px; background:#0f1116; border-radius:10px; overflow:hidden}
<span class="Apple-converted-space">  </span>th, td{padding:10px 10px; border-bottom:1px solid #1d2229; vertical-align:top}
<span class="Apple-converted-space">  </span>th{position:sticky; top:0; background:#12151b; z-index:1; text-align:left; font-weight:600; color:#d7e3ff}
<span class="Apple-converted-space">  </span>tbody tr:last-child td{border-bottom:none}
<span class="Apple-converted-space">  </span>.pill{display:inline-flex; align-items:center; padding:2px 8px; border-radius:999px; font-size:12px; font-weight:600; letter-spacing:.2px}
<span class="Apple-converted-space">  </span>.pill.red{background:color-mix(in oklab, var(--red) 30%, transparent); color:#ffd7d7; border:1px solid color-mix(in oklab, var(--red) 50%, #000 40%)}
<span class="Apple-converted-space">  </span>.pill.yellow{background:color-mix(in oklab, var(--yellow) 25%, transparent); color:#fff2cc; border:1px solid color-mix(in oklab, var(--yellow) 45%, #000 40%)}
<span class="Apple-converted-space">  </span>.pill.green{background:color-mix(in oklab, var(--green) 22%, transparent); color:#d7fff1; border:1px solid color-mix(in oklab, var(--green) 40%, #000 40%)}
<span class="Apple-converted-space">  </span>.muted{color:var(--muted)}
<span class="Apple-converted-space">  </span>.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
<span class="Apple-converted-space">  </span>.hint{font-size:12px; color:var(--muted); margin-top:6px}
<span class="Apple-converted-space">  </span>.grid{display:grid; grid-template-columns:1fr; gap:14px}
<span class="Apple-converted-space">  </span>@media (min-width:900px){ .grid{grid-template-columns: 1.1fr .9fr} }
<span class="Apple-converted-space">  </span>.hidden{display:none !important}
<span class="Apple-converted-space">  </span>.footer-actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
<span class="Apple-converted-space">  </span>.small{font-size:12px}
<span class="Apple-converted-space">  </span>.kbd{padding:.2rem .45rem; border:1px solid var(--border); border-bottom-width:2px; border-radius:6px; background:#11141a; font:12px ui-monospace,monospace; color:#ddecff}
<span class="Apple-converted-space">  </span>.tag{font-size:11px; padding:2px 7px; border-radius:6px; border:1px solid var(--border); color:#cfe1ff}
<span class="Apple-converted-space">  </span>.right{float:right}
</style>
</head>
<body>
<header>
<span class="Apple-converted-space">  </span><h1>Receipt → Storage &amp; Expiration Chart</h1>
<span class="Apple-converted-space">  </span><p>Upload a photo of your grocery receipt. I’ll OCR it, detect the date, and build a color-coded chart with storage tips and weekday expiration.</p>
</header>
<br>
<main>
<span class="Apple-converted-space">  </span><section class="controls">
<span class="Apple-converted-space">    </span><div class="grid">
<span class="Apple-converted-space">      </span><div>
<span class="Apple-converted-space">        </span><label>Upload receipt image (JPG/PNG)</label>
<span class="Apple-converted-space">        </span><input id="fileInput" type="file" accept="image/*" />
<span class="Apple-converted-space">        </span><div class="hint">Good lighting helps OCR. Crop to the receipt if possible.</div>
<br>
<span class="Apple-converted-space">        </span><div id="ocrStatus" class="hint" style="margin-top:8px"></div>
<span class="Apple-converted-space">        </span><div class="progress hidden" id="progress"><span id="bar"></span></div>
<br>
<span class="Apple-converted-space">        </span><div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap">
<span class="Apple-converted-space">          </span><button class="btn primary" id="runOcrBtn">Run OCR &amp; Build Chart</button>
<span class="Apple-converted-space">          </span><button class="btn ghost" id="sampleBtn" title="Uses the Eataly receipt text from your example">Use sample text</button>
<span class="Apple-converted-space">          </span><button class="btn" id="pasteBtn">Paste text</button>
<span class="Apple-converted-space">        </span></div>
<span class="Apple-converted-space">      </span></div>
<br>
<span class="Apple-converted-space">      </span><div>
<span class="Apple-converted-space">        </span><label>Detected/Chosen purchase date</label>
<span class="Apple-converted-space">        </span><input id="purchaseDate" type="date" />
<span class="Apple-converted-space">        </span><div class="hint">If I can’t find the date on the receipt, set it here.</div>
<br>
<span class="Apple-converted-space">        </span><label style="margin-top:12px">Shelf life presets (you can edit per item later)</label>
<span class="Apple-converted-space">        </span><select id="presetSelect">
<span class="Apple-converted-space">          </span><option value="default">Default guide</option>
<span class="Apple-converted-space">          </span><option value="conservative">Conservative (earlier)</option>
<span class="Apple-converted-space">          </span><option value="liberal">Liberal (later)</option>
<span class="Apple-converted-space">        </span></select>
<br>
<span class="Apple-converted-space">        </span><div class="hint small">Categories include: fish, cooked salads, yogurt, cucumbers, fresh herbs, onions/shallots, chocolate/dessert, and a generic fallback.</div>
<span class="Apple-converted-space">      </span></div>
<span class="Apple-converted-space">    </span></div>
<span class="Apple-converted-space">  </span></section>
<br>
<span class="Apple-converted-space">  </span><section class="output">
<span class="Apple-converted-space">    </span><div class="row" style="margin-bottom:8px">
<span class="Apple-converted-space">      </span><div>
<span class="Apple-converted-space">        </span><strong>Parsed items</strong>
<span class="Apple-converted-space">        </span><span class="tag" id="dateBadge"></span>
<span class="Apple-converted-space">      </span></div>
<span class="Apple-converted-space">      </span><div class="right small muted">
<span class="Apple-converted-space">        </span>Tip: click any shelf-life to edit; the expiration &amp; color update automatically.
<span class="Apple-converted-space">      </span></div>
<span class="Apple-converted-space">    </span></div>
<br>
<span class="Apple-converted-space">    </span><div id="tableWrap" class="hidden">
<span class="Apple-converted-space">      </span><table id="resultTable" aria-label="Expiration table">
<span class="Apple-converted-space">        </span><thead>
<span class="Apple-converted-space">          </span><tr>
<span class="Apple-converted-space">            </span><th style="width:32%">Item</th>
<span class="Apple-converted-space">            </span><th style="width:26%">How to store</th>
<span class="Apple-converted-space">            </span><th style="width:16%">Shelf life</th>
<span class="Apple-converted-space">            </span><th style="width:18%">Expires</th>
<span class="Apple-converted-space">            </span><th style="width:8%">Flag</th>
<span class="Apple-converted-space">          </span></tr>
<span class="Apple-converted-space">        </span></thead>
<span class="Apple-converted-space">        </span><tbody id="tbody"></tbody>
<span class="Apple-converted-space">      </span></table>
<br>
<span class="Apple-converted-space">      </span><div class="footer-actions">
<span class="Apple-converted-space">        </span><button class="btn success" id="downloadCsv">Download CSV</button>
<span class="Apple-converted-space">        </span><button class="btn warn" id="printBtn">Print</button>
<span class="Apple-converted-space">        </span><button class="btn" id="copyBtn">Copy table text</button>
<span class="Apple-converted-space">      </span></div>
<span class="Apple-converted-space">    </span></div>
<br>
<span class="Apple-converted-space">    </span><div id="emptyState" class="muted">
<span class="Apple-converted-space">      </span>No results yet. Upload a receipt and press <strong>Run OCR</strong>, or click <strong>Use sample text</strong>.
<span class="Apple-converted-space">    </span></div>
<br>
<span class="Apple-converted-space">    </span><details style="margin-top:12px">
<span class="Apple-converted-space">      </span><summary class="small">Show raw OCR text</summary>
<span class="Apple-converted-space">      </span><pre id="rawText" class="mono" style="white-space:pre-wrap; background:#0c0f14; border:1px solid #1b212a; border-radius:8px; padding:10px; max-height:240px; overflow:auto"></pre>
<span class="Apple-converted-space">    </span></details>
<span class="Apple-converted-space">  </span></section>
<br>
<span class="Apple-converted-space">  </span><section class="about small muted">
<span class="Apple-converted-space">    </span><strong>Notes &amp; assumptions</strong><br>
<span class="Apple-converted-space">    </span>• OCR isn’t perfect — I let you edit shelf life / names inline. <br>
<span class="Apple-converted-space">    </span>• Expiration rules are estimates. When in doubt, trust the package label or nose test. <br>
<span class="Apple-converted-space">    </span>• Color flags: <span class="pill red">≤3 days</span>, <span class="pill yellow">4–10 days</span>, <span class="pill green">>10 days</span>. <br>
<span class="Apple-converted-space">  </span></section>
</main>
<br>
<!-- Tesseract.js (client-side OCR) -->
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
<script>
/* --------------------- utilities ---------------------- */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));
<br>
function fmtDate(d){
<span class="Apple-converted-space">  </span>const dt = new Date(d);
<span class="Apple-converted-space">  </span>const y = dt.getFullYear();
<span class="Apple-converted-space">  </span>const m = String(dt.getMonth()+1).padStart(2,'0');
<span class="Apple-converted-space">  </span>const day = String(dt.getDate()).padStart(2,'0');
<span class="Apple-converted-space">  </span>return `${y}-${m}-${day}`;
}
function humanDate(d){
<span class="Apple-converted-space">  </span>const dt = new Date(d);
<span class="Apple-converted-space">  </span>return dt.toLocaleDateString(undefined,{year:'numeric', month:'short', day:'numeric'}) +
<span class="Apple-converted-space">         </span>" (" + dt.toLocaleDateString(undefined,{weekday:'long'}) + ")";
}
function addDays(base, n){
<span class="Apple-converted-space">  </span>const d = new Date(base);
<span class="Apple-converted-space">  </span>d.setDate(d.getDate() + n);
<span class="Apple-converted-space">  </span>return d;
}
function addMonths(base, n){
<span class="Apple-converted-space">  </span>const d = new Date(base);
<span class="Apple-converted-space">  </span>d.setMonth(d.getMonth() + n);
<span class="Apple-converted-space">  </span>return d;
}
function daysBetween(a,b){ return Math.round((b-a)/(1000*60*60*24)); }
<br>
/* ------------- shelf-life knowledge base ------------- */
const RULES = {
<span class="Apple-converted-space">  </span>default: {
<span class="Apple-converted-space">    </span>fish: {days:2, store:"Refrigerate &amp; cook within 1–2 days or freeze"},
<span class="Apple-converted-space">    </span>cooked_salad: {days:5, store:"Refrigerate in airtight container"},
<span class="Apple-converted-space">    </span>yogurt: {days:10, store:"Refrigerate; keep sealed"},
<span class="Apple-converted-space">    </span>cucumber: {days:7, store:"Refrigerate in crisper drawer"},
<span class="Apple-converted-space">    </span>herb: {days:7, store:"Wrap in damp paper towel; refrigerate in bag/jar"},
<span class="Apple-converted-space">    </span>onion_shallot: {days:30, store:"Cool, dark, ventilated place (not fridge)"},
<span class="Apple-converted-space">    </span>chocolate: {days:21, store:"Cool, dry place; refrigerate if warm"},
<span class="Apple-converted-space">    </span>generic: {days:7, store:"Refrigerate; check package"}
<span class="Apple-converted-space">  </span>},
<span class="Apple-converted-space">  </span>conservative: {
<span class="Apple-converted-space">    </span>fish: {days:2, store:"Refrigerate &amp; cook within 1 day or freeze"},
<span class="Apple-converted-space">    </span>cooked_salad: {days:3, store:"Refrigerate; eat within 3 days"},
<span class="Apple-converted-space">    </span>yogurt: {days:7, store:"Refrigerate; keep sealed"},
<span class="Apple-converted-space">    </span>cucumber: {days:6, store:"Refrigerate in crisper drawer"},
<span class="Apple-converted-space">    </span>herb: {days:5, store:"Wrap damp; refrigerate"},
<span class="Apple-converted-space">    </span>onion_shallot: {days:25, store:"Cool, dark, ventilated"},
<span class="Apple-converted-space">    </span>chocolate: {days:14, store:"Cool, dry place"},
<span class="Apple-converted-space">    </span>generic: {days:5, store:"Refrigerate; check package"}
<span class="Apple-converted-space">  </span>},
<span class="Apple-converted-space">  </span>liberal: {
<span class="Apple-converted-space">    </span>fish: {days:3, store:"Refrigerate or freeze promptly"},
<span class="Apple-converted-space">    </span>cooked_salad: {days:6, store:"Refrigerate, airtight"},
<span class="Apple-converted-space">    </span>yogurt: {days:12, store:"Refrigerate; keep sealed"},
<span class="Apple-converted-space">    </span>cucumber: {days:10, store:"Refrigerate in crisper drawer"},
<span class="Apple-converted-space">    </span>herb: {days:8, store:"Wrap damp; refrigerate"},
<span class="Apple-converted-space">    </span>onion_shallot: {days:45, store:"Cool, dark, ventilated"},
<span class="Apple-converted-space">    </span>chocolate: {days:30, store:"Cool, dry place"},
<span class="Apple-converted-space">    </span>generic: {days:9, store:"Refrigerate; check package"}
<span class="Apple-converted-space">  </span>}
};
<br>
/* keyword → category map (simple heuristics) */
const MAP = [
<span class="Apple-converted-space">  </span>{re:/\b(salmon|cod|tuna|halibut|fillet|fish)\b/i, cat:'fish'},
<span class="Apple-converted-space">  </span>{re:/\b(farro.*salad|potato.*salad|winter.*salad|deli.*salad)\b/i, cat:'cooked_salad'},
<span class="Apple-converted-space">  </span>{re:/\b(yogurt|yoghurt|greek yog|labneh|kefir)\b/i, cat:'yogurt'},
<span class="Apple-converted-space">  </span>{re:/\b(cucumber|persian)\b/i, cat:'cucumber'},
<span class="Apple-converted-space">  </span>{re:/\b(parsley|cilantro|basil|dill|mint|herb)\b/i, cat:'herb'},
<span class="Apple-converted-space">  </span>{re:/\b(shallot|onion)\b/i, cat:'onion_shallot'},
<span class="Apple-converted-space">  </span>{re:/\b(chocolate|fondente|fondentenero|dessert|truffle|candy)\b/i, cat:'chocolate'}
];
<br>
function categorize(name){
<span class="Apple-converted-space">  </span>for (const m of MAP){ if (m.re.test(name)) return m.cat; }
<span class="Apple-converted-space">  </span>return 'generic';
}
<br>
/* -------------------- OCR handling -------------------- */
const fileInput = $('#fileInput');
const runBtn = $('#runOcrBtn');
const sampleBtn = $('#sampleBtn');
const pasteBtn = $('#pasteBtn');
const progress = $('#progress');
const bar = $('#bar');
const statusEl = $('#ocrStatus');
const tableWrap = $('#tableWrap');
const tbody = $('#tbody');
const emptyState = $('#emptyState');
const rawText = $('#rawText');
const purchaseDate = $('#purchaseDate');
const dateBadge = $('#dateBadge');
const presetSelect = $('#presetSelect');
<br>
purchaseDate.value = fmtDate(new Date()); // default today
<br>
runBtn.addEventListener('click', async ()=>{
<span class="Apple-converted-space">  </span>let image = fileInput.files?.[0];
<span class="Apple-converted-space">  </span>if(!image){ alert('Please choose a receipt image first (or click "Use sample text").'); return; }
<span class="Apple-converted-space">  </span>await doOCR(image);
});
<br>
sampleBtn.addEventListener('click', ()=>{
<span class="Apple-converted-space">  </span>const txt = SAMPLE_TEXT.trim();
<span class="Apple-converted-space">  </span>handleParsedText(txt);
});
<br>
pasteBtn.addEventListener('click', ()=>{
<span class="Apple-converted-space">  </span>const txt = prompt("Paste receipt text (or type items, one per line):","");
<span class="Apple-converted-space">  </span>if(txt){ handleParsedText(txt); }
});
<br>
async function doOCR(file){
<span class="Apple-converted-space">  </span>statusEl.textContent = 'Starting OCR…';
<span class="Apple-converted-space">  </span>progress.classList.remove('hidden');
<span class="Apple-converted-space">  </span>bar.style.width = '0%';
<br>
<span class="Apple-converted-space">  </span>const worker = await Tesseract.createWorker('eng', 1, {
<span class="Apple-converted-space">    </span>logger: m => {
<span class="Apple-converted-space">      </span>if(m.status === 'recognizing text'){
<span class="Apple-converted-space">        </span>const pct = Math.round(m.progress*100);
<span class="Apple-converted-space">        </span>bar.style.width = pct + '%';
<span class="Apple-converted-space">        </span>statusEl.textContent = `OCR: ${pct}%`;
<span class="Apple-converted-space">      </span>}
<span class="Apple-converted-space">    </span>}
<span class="Apple-converted-space">  </span>});
<br>
<span class="Apple-converted-space">  </span>const { data: { text } } = await worker.recognize(file);
<span class="Apple-converted-space">  </span>await worker.terminate();
<br>
<span class="Apple-converted-space">  </span>rawText.textContent = text;
<span class="Apple-converted-space">  </span>statusEl.textContent = 'OCR complete.';
<span class="Apple-converted-space">  </span>progress.classList.add('hidden');
<span class="Apple-converted-space">  </span>handleParsedText(text);
}
<br>
/* --------------- parse receipt → items ---------------- */
function handleParsedText(text){
<span class="Apple-converted-space">  </span>rawText.textContent = text;
<br>
<span class="Apple-converted-space">  </span>// Detect purchase date (US style mm/dd/yy or mm/dd/yyyy)
<span class="Apple-converted-space">  </span>const dateMatch = text.match(/\b(0?[1-9]|1[0-2])[\/\-](0?[1-9]|[12][0-9]|3[01])[\/\-]([0-9]{2,4})\b/);
<span class="Apple-converted-space">  </span>if(dateMatch){
<span class="Apple-converted-space">    </span>let [mm, dd, yy] = [dateMatch[1], dateMatch[2], dateMatch[3]];
<span class="Apple-converted-space">    </span>if(yy.length===2){ yy = '20' + yy; }
<span class="Apple-converted-space">    </span>const detected = new Date(`${yy}-${mm.padStart(2,'0')}-${dd.padStart(2,'0')}T12:00:00`);
<span class="Apple-converted-space">    </span>if(!isNaN(detected)) purchaseDate.value = fmtDate(detected);
<span class="Apple-converted-space">  </span>}
<span class="Apple-converted-space">  </span>dateBadge.textContent = "Purchase: " + new Date(purchaseDate.value).toLocaleDateString(undefined,{weekday:'long', month:'short', day:'numeric', year:'numeric'});
<br>
<span class="Apple-converted-space">  </span>// Split into lines and try to extract "item — price" style rows
<span class="Apple-converted-space">  </span>const lines = text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean);
<br>
<span class="Apple-converted-space">  </span>// Heuristic: a line with some letters and a trailing price number
<span class="Apple-converted-space">  </span>const priceRe = /(\$?\s?\d+(?:\.\d{2})?)$/;
<span class="Apple-converted-space">  </span>const likely = lines.filter(l=>{
<span class="Apple-converted-space">    </span>if(l.length<3) return false;
<span class="Apple-converted-space">    </span>if(/receipt|total|subtotal|tax|change|clerk|store|nyc|visa|debit|credit|sales|card|information/i.test(l)) return false;
<span class="Apple-converted-space">    </span>if(/^\d{5,}/.test(l)) return true; // UPC+item line (like your Eataly receipt)
<span class="Apple-converted-space">    </span>if(/[A-Za-z]/.test(l) &amp;&amp; priceRe.test(l)) return true;
<span class="Apple-converted-space">    </span>return false;
<span class="Apple-converted-space">  </span>});
<br>
<span class="Apple-converted-space">  </span>// Build item objects
<span class="Apple-converted-space">  </span>const items = [];
<span class="Apple-converted-space">  </span>for(const ln of likely){
<span class="Apple-converted-space">    </span>// If UPC + name + price (e.g., "852210005159 WHITE MOUSTACHE SUMMER PEACH 8OZ 6.79")
<span class="Apple-converted-space">    </span>let name = ln;
<span class="Apple-converted-space">    </span>// Remove leading long code(s)
<span class="Apple-converted-space">    </span>name = name.replace(/^[\d\s]{6,}\s+/,'');
<span class="Apple-converted-space">    </span>// Remove quantity/weight fragments like "0.200 lb @ $3.99/lb 0.80"
<span class="Apple-converted-space">    </span>name = name.replace(/\b\d+(?:\.\d+)?\s*(lb|oz|@|\$|pkg|ea|ct|x|lb\.?)\b.*$/i, m=>{
<span class="Apple-converted-space">      </span>// keep name before the weight/price cluster if there's an earlier word run
<span class="Apple-converted-space">      </span>return '';
<span class="Apple-converted-space">    </span>}).trim() || ln.replace(/^\d+\s+/,'');
<span class="Apple-converted-space">    </span>// If we removed too much, fallback to original (minus trailing price)
<span class="Apple-converted-space">    </span>if(name.length < 3){
<span class="Apple-converted-space">      </span>name = ln.replace(priceRe,'').trim();
<span class="Apple-converted-space">    </span>}
<br>
<span class="Apple-converted-space">    </span>// Extract trailing price if present (not used, but handy)
<span class="Apple-converted-space">    </span>const pm = ln.match(priceRe);
<span class="Apple-converted-space">    </span>const price = pm ? pm[1].replace('$','').trim() : '';
<br>
<span class="Apple-converted-space">    </span>// sanitize name
<span class="Apple-converted-space">    </span>name = name.replace(/\s{2,}/g,' ').replace(/\bEA\b/i,'').trim();
<span class="Apple-converted-space">    </span>// Prevent obvious non-item rows
<span class="Apple-converted-space">    </span>if(/^\$/.test(name) || /TOTAL|SUBTOTAL|TAX/i.test(name)) continue;
<br>
<span class="Apple-converted-space">    </span>items.push({raw: ln, name, price});
<span class="Apple-converted-space">  </span>}
<br>
<span class="Apple-converted-space">  </span>// Deduplicate by name (simple)
<span class="Apple-converted-space">  </span>const seen = new Set();
<span class="Apple-converted-space">  </span>const dedup = items.filter(x=>{
<span class="Apple-converted-space">    </span>const key = x.name.toLowerCase();
<span class="Apple-converted-space">    </span>if(seen.has(key)) return false;
<span class="Apple-converted-space">    </span>seen.add(key); return true;
<span class="Apple-converted-space">  </span>});
<br>
<span class="Apple-converted-space">  </span>buildTable(dedup);
}
<br>
/* -------------- build interactive table --------------- */
function shelfLifeFor(name){
<span class="Apple-converted-space">  </span>const preset = RULES[presetSelect.value] || RULES.default;
<span class="Apple-converted-space">  </span>const cat = categorize(name);
<span class="Apple-converted-space">  </span>const rule = preset[cat] || preset.generic;
<span class="Apple-converted-space">  </span>return {cat, ...rule};
}
<br>
function colorFlag(days){
<span class="Apple-converted-space">  </span>if(days <= 3) return {cls:'red', label:'Use ASAP'};
<span class="Apple-converted-space">  </span>if(days <= 10) return {cls:'yellow', label:'Use Soon'};
<span class="Apple-converted-space">  </span>return {cls:'green', label:'Lasts a while'};
}
<br>
function buildTable(items){
<span class="Apple-converted-space">  </span>tbody.innerHTML = '';
<span class="Apple-converted-space">  </span>const base = new Date(purchaseDate.value);
<br>
<span class="Apple-converted-space">  </span>if(!items.length){
<span class="Apple-converted-space">    </span>tableWrap.classList.add('hidden');
<span class="Apple-converted-space">    </span>emptyState.classList.remove('hidden');
<span class="Apple-converted-space">    </span>return;
<span class="Apple-converted-space">  </span>}
<br>
<span class="Apple-converted-space">  </span>for(const it of items){
<span class="Apple-converted-space">    </span>const rule = shelfLifeFor(it.name);
<span class="Apple-converted-space">    </span>const tr = document.createElement('tr');
<br>
<span class="Apple-converted-space">    </span>// Compute expiry
<span class="Apple-converted-space">    </span>let expires;
<span class="Apple-converted-space">    </span>if(rule.months){ expires = addMonths(base, rule.months); }
<span class="Apple-converted-space">    </span>else { expires = addDays(base, rule.days); }
<br>
<span class="Apple-converted-space">    </span>const days = daysBetween(base, expires);
<span class="Apple-converted-space">    </span>const flag = colorFlag(days);
<br>
<span class="Apple-converted-space">    </span>tr.innerHTML = `
<span class="Apple-converted-space">      </span><td><div style="font-weight:600">${escapeHtml(titleCase(it.name))}</div>
<span class="Apple-converted-space">          </span><div class="muted mono small">${escapeHtml(it.raw)}</div></td>
<span class="Apple-converted-space">      </span><td>${escapeHtml(rule.store)}</td>
<span class="Apple-converted-space">      </span><td>
<span class="Apple-converted-space">        </span><input class="lifeInput" type="text" value="${rule.days ?? (rule.months*30)} days"<span class="Apple-converted-space"> </span>
<span class="Apple-converted-space">               </span>style="width:120px; padding:6px 8px; border:1px solid var(--border); border-radius:8px; background:#0f1217; color:var(--txt)">
<span class="Apple-converted-space">        </span><div class="hint small">edit (e.g. “5 days” or “2 months”)</div>
<span class="Apple-converted-space">      </span></td>
<span class="Apple-converted-space">      </span><td class="expiresCell"><strong>${escapeHtml(humanDate(expires))}</strong></td>
<span class="Apple-converted-space">      </span><td class="flagCell"><span class="pill ${flag.cls}">${flag.label}</span></td>
<span class="Apple-converted-space">    </span>`;
<span class="Apple-converted-space">    </span>tbody.appendChild(tr);
<span class="Apple-converted-space">  </span>}
<br>
<span class="Apple-converted-space">  </span>tableWrap.classList.remove('hidden');
<span class="Apple-converted-space">  </span>emptyState.classList.add('hidden');
<span class="Apple-converted-space">  </span>dateBadge.textContent = "Purchase: " + new Date(purchaseDate.value).toLocaleDateString(undefined,{weekday:'long', month:'short', day:'numeric', year:'numeric'});
<br>
<span class="Apple-converted-space">  </span>// attach editors
<span class="Apple-converted-space">  </span>$$('#resultTable .lifeInput').forEach((inp, idx)=>{
<span class="Apple-converted-space">    </span>inp.addEventListener('change', ()=>{
<span class="Apple-converted-space">      </span>const val = inp.value.trim().toLowerCase();
<span class="Apple-converted-space">      </span>let nDays = 7;
<span class="Apple-converted-space">      </span>const m = val.match(/(\d+(?:\.\d+)?)\s*(day|days|d|month|months|mo)/);
<span class="Apple-converted-space">      </span>if(m){
<span class="Apple-converted-space">        </span>const num = parseFloat(m[1]);
<span class="Apple-converted-space">        </span>const unit = m[2];
<span class="Apple-converted-space">        </span>nDays = /mo|month/.test(unit) ? Math.round(num*30) : Math.round(num);
<span class="Apple-converted-space">      </span>}
<span class="Apple-converted-space">      </span>const base = new Date(purchaseDate.value);
<span class="Apple-converted-space">      </span>const newExp = addDays(base, nDays);
<br>
<span class="Apple-converted-space">      </span>const row = inp.closest('tr');
<span class="Apple-converted-space">      </span>row.querySelector('.expiresCell').innerHTML = `<strong>${escapeHtml(humanDate(newExp))}</strong>`;
<span class="Apple-converted-space">      </span>const flag = colorFlag(nDays);
<span class="Apple-converted-space">      </span>const flagCell = row.querySelector('.flagCell');
<span class="Apple-converted-space">      </span>flagCell.innerHTML = `<span class="pill ${flag.cls}">${flag.label}</span>`;
<span class="Apple-converted-space">    </span>});
<span class="Apple-converted-space">  </span>});
}
<br>
/* --------------------- actions ------------------------ */
$('#downloadCsv').addEventListener('click', ()=>{
<span class="Apple-converted-space">  </span>const rows = [['Item','How to store','Shelf life','Expires','Flag']];
<span class="Apple-converted-space">  </span>$$('#resultTable tbody tr').forEach(tr=>{
<span class="Apple-converted-space">    </span>const tds = tr.querySelectorAll('td');
<span class="Apple-converted-space">    </span>rows.push([
<span class="Apple-converted-space">      </span>tds[0].firstElementChild.textContent.trim(),
<span class="Apple-converted-space">      </span>tds[1].textContent.trim(),
<span class="Apple-converted-space">      </span>tds[2].querySelector('input').value.trim(),
<span class="Apple-converted-space">      </span>tds[3].textContent.trim(),
<span class="Apple-converted-space">      </span>tds[4].textContent.trim()
<span class="Apple-converted-space">    </span>]);
<span class="Apple-converted-space">  </span>});
<span class="Apple-converted-space">  </span>const csv = rows.map(r=>r.map(s=>`"${s.replace(/"/g,'""')}"`).join(',')).join('\n');
<span class="Apple-converted-space">  </span>const blob = new Blob([csv], {type:'text/csv'});
<span class="Apple-converted-space">  </span>const url = URL.createObjectURL(blob);
<span class="Apple-converted-space">  </span>const a = Object.assign(document.createElement('a'), {href:url, download:`receipt-expirations-${fmtDate(new Date())}.csv`});
<span class="Apple-converted-space">  </span>document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
$('#printBtn').addEventListener('click', ()=> window.print());
$('#copyBtn').addEventListener('click', ()=>{
<span class="Apple-converted-space">  </span>const lines = [];
<span class="Apple-converted-space">  </span>$$('#resultTable tbody tr').forEach(tr=>{
<span class="Apple-converted-space">    </span>const [item, store, life, exp, flag] = tr.querySelectorAll('td');
<span class="Apple-converted-space">    </span>lines.push(`${item.firstElementChild.textContent} — ${store.textContent} — ${life.querySelector('input').value} — ${exp.textContent} — ${flag.textContent}`);
<span class="Apple-converted-space">  </span>});
<span class="Apple-converted-space">  </span>navigator.clipboard.writeText(lines.join('\n'));
<span class="Apple-converted-space">  </span>alert('Table copied to clipboard.');
});
purchaseDate.addEventListener('change', ()=>{
<span class="Apple-converted-space">  </span>// recompute expirations for all rows
<span class="Apple-converted-space">  </span>$$('#resultTable tbody tr').forEach(tr=>{
<span class="Apple-converted-space">    </span>const inp = tr.querySelector('.lifeInput');
<span class="Apple-converted-space">    </span>inp.dispatchEvent(new Event('change'));
<span class="Apple-converted-space">  </span>});
<span class="Apple-converted-space">  </span>dateBadge.textContent = "Purchase: " + new Date(purchaseDate.value).toLocaleDateString(undefined,{weekday:'long', month:'short', day:'numeric', year:'numeric'});
});
<br>
/* ---------------- sample (your Eataly) ---------------- */
const SAMPLE_TEXT = `
EATALY
200 5th Ave. New York City, NY 10010
10/28/25 5:45 PM
Clerk: Cyrus Kisitu
852210005159 WHITE MOUSTACHE SUMMER PEACH 8OZ 6.79
852210005012 WHITE MOUSTACHE GREEK YOG 8 OZ 6.79
34047 ORGANIC SALMON FILLET 0.15
0.005 lb @ $29.99/lb
2063012 FARRO WINTER SALAD 14.99NYT
8006380230039 MINI FONDENTENERO 16 13.99NYT
05783690001 CUCUMBER PERSIAN ORGANIC 12X1LB 4.99
10634 ONION SHALLOT 0.200 lb @ $3.99/lb 0.80
10397 HERB PARSLEY ITALIAN FRESH 1.99
SUBTOTAL 50.49
NYC SALES TAX 8.875% 2.57
TOTAL 53.06
`;
<br>
/* ------------------- helpers -------------------------- */
function titleCase(s){ return s.toLowerCase().replace(/\b\w/g,c=>c.toUpperCase()); }
function escapeHtml(s){ return s.replace(/[&amp;<>"']/g, c => ({'&amp;':'&amp;amp;','<':'&amp;lt;','>':'&amp;gt;','"':'&amp;quot;',"'":'&amp;#39;'}[c])); }
</script>
</body>
</html>
</body>
</html>
